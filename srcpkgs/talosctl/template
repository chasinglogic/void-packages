# Template file for 'talosctl'
pkgname=talosctl
version=1.8.1
revision=1
build_style=go
go_import_path="github.com/siderolabs/talos"
go_package="${go_import_path}/cmd/talosctl"
go_build_tags="grpcnotrace"
# use $(:) to silence xlint
go_ldflags=$(:)
short_desc="Talos Linux CLI client"
maintainer="Mathew Robinson <chasinglogic@gmail.com>"
license="MPL-2.0"
homepage="https://www.talos.dev"
changelog="https://github.com/siderolabs/talos/releases"
distfiles="https://github.com/siderolabs/talos/archive/refs/tags/v${version}.tar.gz"
checksum=65e2a8e046840d9df9a622c59652c825d7f937a29b70fd8ff6980900e6cf7765

pre_build() {
	local _date
	if [ "$SOURCE_DATE_EPOCH" ]; then
		_date="$(date --utc --date "@$SOURCE_DATE_EPOCH" "+%Y-%m-%d")"
		go_ldflags="-X github.com/siderolabs/talos/pkg/machinery/version.Built=${_date}"
	fi
}
